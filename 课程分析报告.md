<h1>基于flask的全国疫情数据可视化</h1>


<h2>一、需求分析</h2>

a1、实现全球新冠疫情实时数据地图模块

a2、实现全球累计趋势Top15模块

a3、实现全球各洲新增趋势模块

a4、实现累计确诊国家Top5模块

a5、实现各洲累计治愈模块

b1、实现中国新冠疫情实时数据地图模块

b2、实现各省新增病例模块

b3、实现各省累计确诊模块

b4、实现中国各省死亡率与治愈率变化趋势模块

b5、实现全国累计治愈与死亡率随时间变化情况模块


<h2>二、开发工具准备</h2>

<p>操作系统：Windows 10及以上<p>
 
虚拟环境：virtualenv 

数据库：PyMySQL + MySQL 

开发工具：PyCharm + Jupyter 

开发框架： Flask + SQLAlchemy + Flask-Script+ Flask-Migrate+ jQuery+ blueprint等

浏览器：Chrome浏览器

<h2>二、爬虫实现</h2>

####1、实现思路

#####（1）全球疫情数据
使用python爬虫对腾讯疫情网站全球疫情数据进行爬取，封装成一个函数返回一个字典数据格式的对象，然后写另一个方法调用该函数接收返回值，和数据库取得连接后把数据存储到mysql数据库。

#####（2） 全国疫情数据
使用python爬虫对腾讯疫情网站全国疫情数据进行爬取，用request请求接口，转为json对象，然后通过一个for循环对我们的列表进行取值然后再存入到我们的dataframe中，保存为csv文件，最后存到mysql数据库。



####2、爬虫实现部分代码
a、全国疫情数据爬取

![avatar](pictures/14.png)

b、全球疫情数据爬取

![avatar](pictures/a.png)

####3、数据预处理

对于爬下来的数据，首先进行数据预处理，

（1）冗余数据去除

（2）统计各省的疫情数据

（3）使用pd.to_datetime() 或time.strftime()时间处理函数处理日期格式，统计每日各省疫情数据

（4）统计全国疫情的治愈率和死亡率

（5）统计各大洲的疫情数据，保存到数据库


<h2>三、项目配置</h2>

####1. 创建项目 Flask_SQLAlchemy_ready

#####文件夹结构

![avatar](pictures/0.png)

####2. 配置虚拟环境
	
	安装virtualenv：pip install virtualenv -i https://pypi.douban.com/simple(如果已安装virtualenv，这条命令可不执行，可使用 where virtualenv 查看是否已安装)
	
	创建虚拟环境：virtualenv  venv 

	激活虚拟环境 ：venv\Scripts\activate

####3. 安装项目所需的库（requirements.txt）

	pip install -r requirements.txt -i https://pypi.tsinghua.edu.cn/simple

####4. 创建各类型文件，并编写源码

####5. 创建dt数据库，并根据自己的数据库账号密码配置数据库和数据库名

####6. 在Terminal中使用migrate创建数据表
	python manage.py db init  # 创建迁移数据库，首次使用
	python manage.py db migrate # 创建迁移脚本 
	python manage.py db upgrade # 把迁移应用到数据库中

####7. 刷新一下数据库
	
![avatar](pictures/2.jpg)
<p>以下是全球疫情的数据</p>
![avatar](pictures/21.png)

####8. 运行manage.py 
	
	python manage.py runserver

####9. 访问http://127.0.0.1:5000/端口

<h2>四、flask工程实现</h2>
####1. flask蓝图
（1）创建蓝图

	user = Blueprint("user", __name__)
（2）注册蓝图
    
	app.register_blueprint(user)

####2. 链接数据库配置

	app.config['JSON_AS_ASCII'] = False
    app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql+pymysql://root:12345678@localhost:3306/dt'

####3. 数据库迁移
![avatar](pictures/3.png)
####4. 相关文件配置部分代码
<p>初始化文件</p>
![avatar](pictures/4.png)
<p>models.py文件</p>
![avatar](pictures/13.jpg)
<p>manage.py文件</p>
![avatar](pictures/6.jpg)
####5. flask前端页面实现

#####a、全球累计趋势Top15模块展示
<p>通过ajax请求加载后端的数据，然后渲染到前端页面展示，部分代码如下：</p>
![avatar](pictures/b.png)
![avatar](pictures/c.png)
#####效果图
![avatar](pictures/d.png)

#####b、中国地图展示
<p>后端核心代码：使用query()函数，查询数据封装成一个函数</p>
![avatar](pictures/12.png)
<p>通过调用该函数获取所需数据</p>
![avatar](pictures/11.png)
<p>前端核心代码：通过ajax请求加载后端的数据，然后渲染到前端页面展示，部分代码如下：</p>
![avatar](pictures/8.png)

![avatar](pictures/10.png)
#####效果图
![avatar](pictures/9.png)

<h2>五、全球疫情数据可视化页面</h2>

![avatar](pictures/99.jpg)

<h2>六、全国疫情数据可视化页面</h2>

![avatar](pictures/100.jpg)

<h2>七、总结</h2>
通过这段时间对该项目的整个流程，从爬取数据到创建项目环境再到通过这学期所学习的一些知识点运用到该项目中，更加意识到要做一个完整项目，首先确定总体框架，搭建环境，然后需要花很多时间，一点点调试，最后才完成该项目，也让我窥见了flask和python的强大，需要花更多的时间不断的去学习和实践。
